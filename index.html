<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Student Management</h1>
    
    <form id="studentForm">
        <input type="text" id="name" placeholder="Name" required>
        <input type="text" id="class" placeholder="Class" required>
        <input type="number" id="roll_number" placeholder="Roll Number" required>
        <button type="submit">Add Student</button>
    </form>

    <table border="1" id="studentTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Class</th>
                <th>Roll Number</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        $(document).ready(function() {
            // Fetch and display students
            function fetchStudents() {
                $.ajax({
                    url: 'api.php',
                    type: 'GET',
                    success: function(data) {
                        const students = JSON.parse(data);
                        const tbody = $('#studentTable tbody');
                        tbody.empty();
                        students.forEach(student => {
                            tbody.append(`
                                <tr data-id="${student.id}">
                                    <td class="name">${student.name}</td>
                                    <td class="class">${student.class}</td>
                                    <td class="roll_number">${student.roll_number}</td>
                                    <td>
                                        <button class="edit">Edit</button>
                                        <button class="delete">Delete</button>
                                    </td>
                                </tr>
                            `);
                        });
                    }
                });
            }
            fetchStudents();

            // Add new student
            $('#studentForm').on('submit', function(e) {
                e.preventDefault();
                $.ajax({
                    url: 'api.php',
                    type: 'POST',
                    data: {
                        name: $('#name').val(),
                        class: $('#class').val(),
                        roll_number: $('#roll_number').val(),
                    },
                    success: function() {
                        fetchStudents();
                        $('#studentForm')[0].reset();
                    }
                });
            });

            // Edit student
            $(document).on('click', '.edit', function() {
                const row = $(this).closest('tr');
                const id = row.data('id');
                const name = row.find('.name').text();
                const className = row.find('.class').text();
                const rollNumber = row.find('.roll_number').text();
                
                $('#name').val(name);
                $('#class').val(className);
                $('#roll_number').val(rollNumber);
                $('#studentForm').off('submit').on('submit', function(e) {
                    e.preventDefault();
                    $.ajax({
                        url: 'api.php',
                        type: 'PUT',
                        data: {
                            id: id,
                            name: $('#name').val(),
                            class: $('#class').val(),
                            roll_number: $('#roll_number').val(),
                        },
                        success: function() {
                            fetchStudents();
                            $('#studentForm')[0].reset();
                        }
                    });
                });
            });

            // Delete student
            $(document).on('click', '.delete', function() {
                const id = $(this).closest('tr').data('id');
                $.ajax({
                    url: 'api.php',
                    type: 'DELETE',
                    data: { id: id },
                    success: function() {
                        fetchStudents();
                    }
                });
            });
        });
    </script>
</body>
</html>
